<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Spin - Select Participants, Pick Winner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: #0f172a; color: #e2e8f0; margin: 0; padding: 24px; display: flex; justify-content: center; }
    .card { width: 100%; max-width: 720px; background: #111827; border: 1px solid #1f2937; border-radius: 12px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    h1 { font-size: 22px; margin: 0 0 16px 0; color: #f8fafc; }
    .rows { display: grid; grid-template-columns: 1fr; gap: 10px; }
    .row { display: flex; align-items: center; gap: 10px; background: #0b1220; border: 1px solid #1f2937; border-radius: 10px; padding: 10px; }
    .row label { font-size: 12px; color: #94a3b8; min-width: 58px; }
    .include { width: 18px; height: 18px; accent-color: #3b82f6; }
    .name-input { flex: 1; background: #0b1220; color: #e5e7eb; border: 1px solid #243248; border-radius: 8px; padding: 9px 12px; outline: none; transition: border-color 0.15s ease, box-shadow 0.15s ease; }
    .name-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.25); }
    .actions { display: flex; gap: 10px; align-items: center; margin-top: 16px; flex-wrap: wrap; }
    button { appearance: none; border: none; cursor: pointer; background: linear-gradient(135deg, #2563eb, #06b6d4); color: white; padding: 10px 16px; border-radius: 10px; font-weight: 600; transition: transform 0.06s ease-in-out, opacity 0.2s ease; }
    .secondary { background: #334155; }
    .ghost { background: #1f2937; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    button:active:not(:disabled) { transform: translateY(1px); }
    .muted { color: #94a3b8; font-size: 12px; }
    .error { color: #fca5a5; font-size: 13px; min-height: 18px; margin-top: 4px; }
    .spin-row { display: flex; align-items: center; gap: 12px; margin-top: 8px; }
    .wheel { width: 56px; height: 56px; border-radius: 50%; border: 6px solid #1f2937; border-top-color: #3b82f6; animation: spin 0.9s linear infinite; display: none; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .result-card { margin-top: 16px; background: #0b1220; border: 1px solid #1f2937; border-radius: 12px; padding: 16px; }
    .winner { font-size: 20px; font-weight: 700; color: #f8fafc; margin-top: 6px; }
    .badge { padding: 4px 8px; background: #1e293b; border-radius: 999px; font-size: 12px; margin-left: auto; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Spin: Select Participants, Pick 1 Winner</h1>

    <div class="rows" id="rows">
      <!-- Rows generated by JS -->
    </div>

    <div class="actions">
      <button id="selectAllBtn" class="ghost" type="button">Select All</button>
      <button id="clearAllBtn" class="ghost" type="button">Clear All</button>
      <span id="selectedCount" class="badge">0 selected</span>
    </div>

    <div class="actions" style="margin-top:10px;">
      <button id="spinBtn" type="button">Spin</button>
      <button id="pickAgainBtn" type="button" style="display:none;">Pick Again</button>
      <button id="resetBtn" class="secondary" type="button">Reset</button>
      <span class="muted">Check who joins, then spin.</span>
    </div>
    <div class="error" id="errorMsg"></div>

    <div class="spin-row">
      <div class="wheel" id="wheel"></div>
      <span class="muted" id="spinningText" style="display:none;">Spinning...</span>
    </div>

    <div class="result-card" id="resultCard" style="display:none;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
        <strong>Winner</strong>
        <button id="copyBtn" type="button" style="background:#16a34a;">Copy</button>
      </div>
      <div id="winnerName" class="winner"></div>
    </div>
  </div>

  <script>
    const rowsContainer = document.getElementById("rows");
    const selectedCount = document.getElementById("selectedCount");
    const spinBtn = document.getElementById("spinBtn");
    const pickAgainBtn = document.getElementById("pickAgainBtn");
    const resetBtn = document.getElementById("resetBtn");
    const selectAllBtn = document.getElementById("selectAllBtn");
    const clearAllBtn = document.getElementById("clearAllBtn");
    const errorMsg = document.getElementById("errorMsg");
    const wheel = document.getElementById("wheel");
    const spinningText = document.getElementById("spinningText");
    const resultCard = document.getElementById("resultCard");
    const winnerNameEl = document.getElementById("winnerName");
    const copyBtn = document.getElementById("copyBtn");

    const inputRows = [];
    for (let i = 1; i <= 10; i++) {
      const row = document.createElement("div");
      row.className = "row";
      row.innerHTML = `
        <label>Name ${i}</label>
        <input type="checkbox" class="include" id="c${i}" />
        <input type="text" class="name-input" id="n${i}" placeholder="Enter name" />
      `;
      rowsContainer.appendChild(row);
      inputRows.push({
        checkbox: row.querySelector("#c" + i),
        input: row.querySelector("#n" + i)
      });
    }

    function updateSelectedCount() {
      const count = inputRows.filter(r => r.checkbox.checked).length;
      selectedCount.textContent = count + " selected";
    }

    function getSelectedNames() {
      return inputRows
        .filter(r => r.checkbox.checked)
        .map(r => r.input.value.trim());
    }

    function validate() {
      const selected = inputRows.filter(r => r.checkbox.checked);
      if (selected.length === 0) return "Select at least one participant.";
      const emptySelected = selected.some(r => !r.input.value.trim());
      if (emptySelected) return "All selected participants must have names.";
      return "";
    }

    function setSpinning(isSpinning) {
      spinBtn.disabled = isSpinning;
      pickAgainBtn.disabled = isSpinning;
      selectAllBtn.disabled = isSpinning;
      clearAllBtn.disabled = isSpinning;
      wheel.style.display = isSpinning ? "inline-block" : "none";
      spinningText.style.display = isSpinning ? "inline" : "none";
    }

    function pickRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function renderWinner(name) {
      winnerNameEl.textContent = name;
      resultCard.style.display = "block";
      pickAgainBtn.style.display = "inline-block";
    }

    function spinOnce() {
      errorMsg.textContent = "";
      const err = validate();
      if (err) { errorMsg.textContent = err; return; }
      const names = getSelectedNames();
      setSpinning(true);
      setTimeout(() => {
        renderWinner(pickRandom(names));
        setSpinning(false);
      }, 1200);
    }

    spinBtn.addEventListener("click", spinOnce);
    pickAgainBtn.addEventListener("click", () => {
      errorMsg.textContent = "";
      const err = validate();
      if (err) { errorMsg.textContent = err; return; }
      const names = getSelectedNames();
      setSpinning(true);
      setTimeout(() => {
        renderWinner(pickRandom(names));
        setSpinning(false);
      }, 800);
    });

    selectAllBtn.addEventListener("click", () => {
      inputRows.forEach(r => r.checkbox.checked = true);
      updateSelectedCount();
    });
    clearAllBtn.addEventListener("click", () => {
      inputRows.forEach(r => r.checkbox.checked = false);
      updateSelectedCount();
    });
    resetBtn.addEventListener("click", () => {
      inputRows.forEach(r => {
        r.checkbox.checked = false;
        r.input.value = "";
      });
      updateSelectedCount();
      errorMsg.textContent = "";
      resultCard.style.display = "none";
      pickAgainBtn.style.display = "none";
    });

    inputRows.forEach(r => {
      r.checkbox.addEventListener("change", updateSelectedCount);
      r.input.addEventListener("input", () => {
        if (errorMsg.textContent) errorMsg.textContent = "";
      });
    });
    updateSelectedCount();

    copyBtn.addEventListener("click", async () => {
      const text = winnerNameEl.textContent.trim();
      try {
        await navigator.clipboard.writeText(text || "");
        copyBtn.textContent = "Copied!";
        setTimeout(() => (copyBtn.textContent = "Copy"), 1200);
      } catch {
        copyBtn.textContent = "Failed";
        setTimeout(() => (copyBtn.textContent = "Copy"), 1200);
      }
    });
  </script>
</body>
</html>